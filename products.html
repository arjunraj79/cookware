<!DOCTYPE html>
<html lang="en">
<head>
    <script src="/components/js/head.js"></script>
</head>
<body>
   <script src="/components/js/header.js"></script>

  <script src="/components/js/mobile-nav.js"></script>

  <main>
    <section style="padding:2rem;text-align:left;">
      <h1>All Products</h1>
      <p style="color:#555;margin-bottom:1rem;">Browse all Steelbird products. Click a product to open its product page.</p>
    </section>

    <section style="padding:2rem;">
      <div id="products-grid" class="product-grid">
        
      </div>
    </section>
  </main>

  <footer>
    <script src="/components/js/footer.js"></script>
  </footer>

  <button id="scroll-to-top"><i class="fa-solid fa-arrow-up"></i></button>

  <script src="main.js"></script>
  <nav class="mobile-bottom-nav" aria-label="Mobile navigation">
    <div class="nav-row">
      <a href="#" class="mobile-menu"><i class="fa-solid fa-bars"></i><span>Menu</span></a>
      <a href="cart.html" class="mobile-cart"><i class="fa-solid fa-cart-shopping"></i><span>Cart</span></a>
      <a href="index.html" class="mobile-home"><i class="fa-solid fa-home"></i><span>Home</span></a>
            <a href="/login.html" class="mobile-login"><i class="fa-solid fa-user"></i><span>Profile</span></a>
    </div>
  </nav>
  <script>
    (function(){
      // load products from categories/products.json and render a grid (supports optional search query ?q=...)
      const urlParams = new URLSearchParams(window.location.search);
      const searchQuery = (urlParams.get('q') || '').trim();

      fetch('categories/products.json')
        .then(r => r.json())
        .then(products => {
          const grid = document.getElementById('products-grid');
          if(!grid) return;
          grid.innerHTML = '';

          let shown = products;
          if(searchQuery){
            const q = searchQuery.toLowerCase();
            shown = products.filter(p => {
              if(!p) return false;
              if((p.id||'').toLowerCase().includes(q)) return true;
              if((p.title||'').toLowerCase().includes(q)) return true;
              if((p.subtitle||'').toLowerCase().includes(q)) return true;
              if((p.descriptionHtml||'').toLowerCase().replace(/<[^>]*>/g,'').includes(q)) return true;
              if(Array.isArray(p.features) && p.features.join(' ').toLowerCase().includes(q)) return true;
              if(p.specs && Object.values(p.specs).join(' ').toLowerCase().includes(q)) return true;
              return false;
            });
            const heading = document.querySelector('main h1');
            if(heading) heading.textContent = `Search results for "${searchQuery}"`;
            if(shown.length === 0){
              const p = document.createElement('p');
              p.textContent = 'No products found for your search.';
              p.style.color = '#777';
              p.style.marginTop = '0.5rem';
              document.querySelector('main').insertBefore(p, document.querySelector('main').children[1]);
            }
          }

          shown.forEach(p => {
            const card = document.createElement('div');
            card.className = 'product-card';
            card.dataset.id = p.id || '';
            const img = (p.images && p.images[0]) ? p.images[0] : 'assets/images/category-1.jpg';
            card.innerHTML = `
              <a href="categories/product-template.html?id=${encodeURIComponent(p.id)}">
                <div class="hexagon"><img src="${img}" alt="${p.title || ''}"></div>
              </a>
              <h3><a href="categories/product-template.html?id=${encodeURIComponent(p.id)}">${p.title || ''}</a></h3>
              <p>₹${p.price || 0}</p>
              <button class="btn-secondary">Add to Cart</button>
            `;
            grid.appendChild(card);
          });
        })
        .catch(err => { console.error('Failed to load products', err); });

      // delegate add-to-cart from grid — navigate to product page first
      document.addEventListener('click', function(e){
        if(e.target.classList.contains('btn-secondary') && e.target.closest('.product-card')){
          const card = e.target.closest('.product-card');
          const id = card.dataset.id;
          window.location.href = 'categories/product-template.html?id=' + encodeURIComponent(id);
        }
      });
    })();
  </script>
</body>
</html>