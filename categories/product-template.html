<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product — Template</title>
    <meta name="description" content="Product page template">
    <link rel="icon" type="image/x-icon" href="/assets/favicon.ico">
    <link rel="stylesheet" href="/style.css">
    <link rel="stylesheet" href="/assets/css/header.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" 
          integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" 
          crossorigin="anonymous" referrerpolicy="no-referrer">
</head>
<body>
    <script src="/components/js/header.js"></script>
    <script src="/components/js/mobile-nav.js"></script>
    

    <main>
        <section class="product-breadcrumb" style="text-align:left;padding:1.5rem 2rem;">
            <a href="../index.html">Home</a> &raquo; <a href="../index.html">Category</a> &raquo; <strong id="product-breadcrumb-title">Product Name</strong>
        </section>

        <section class="product-hero" style="padding:0 2rem 2rem 2rem;">
            <style>
                .product-carousel {
                    height: 400px;
                    touch-action: pan-y;
                    cursor: grab;
                    overflow: hidden;
                    position: relative;
                    margin: 0;
                    padding: 0;
                    box-sizing: border-box;
                }
                .product-carousel.grabbing {
                    cursor: grabbing;
                }
                .product-carousel-track {
                    position: absolute;
                    display: flex;
                    height: 100%;
                    transition: transform 0.3s ease-out;
                    will-change: transform;
                }
                .product-carousel.dragging .product-carousel-track {
                    transition: none;
                }
                .product-carousel-slide {
                    flex-shrink: 0;
                    width: 380px;
                    height: 380px;
                    margin-right: 15px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    background: #fff;
                    border-radius: 8px;
                    overflow: hidden;
                }
                .product-carousel-slide img {
                    width: 100%;
                    height: 100%;
                    object-fit: contain;
                    display: block;
                    pointer-events: none;
                    user-select: none;
                }
                .product-carousel-slide.video-slide {
                    padding: 20px;
                    background: #f5f5f5;
                }
                .product-carousel-slide.video-slide iframe {
                    width: 100%;
                    height: 100%;
                    border-radius: 8px;
                    border: none;
                }
                .carousel-dots {
                    display: flex;
                    justify-content: center;
                    gap: 8px;
                    margin-top: 15px;
                }
                .carousel-dot {
                    width: 10px;
                    height: 10px;
                    border-radius: 50%;
                    background: #ccc;
                    border: none;
                    cursor: pointer;
                    transition: background 0.3s, transform 0.2s;
                }
                .carousel-dot.active {
                    background: #333;
                    transform: scale(1.2);
                }
                .carousel-dot:hover {
                    background: #999;
                }
                @media (max-width: 768px) {
                    .product-carousel {
                        height: 320px;
                    }
                    .product-carousel-slide {
                        width: 280px;
                        height: 280px;
                        margin-right: 10px;
                    }
                }
                @media (max-width: 480px) {
                    .product-carousel {
                        height: 280px;
                    }
                    .product-carousel-slide {
                        width: 240px;
                        height: 240px;
                    }
                }
            </style>
            <div class="product-carousel" id="product-slider">
                <div class="product-carousel-track" id="carousel-track">
                    <!-- slides will be injected here -->
                </div>
            </div>
            <div class="carousel-dots" id="carousel-dots"></div>
        </section>

        <section class="product-details" style="padding:2rem;">
            <div style="display:flex;gap:2rem;align-items:flex-start;flex-wrap:wrap;">
                <div class="product-description" style="flex:1;min-width:300px;">
                    <div class="product-description-box">
                        <h1 id="product-title">Product Title</h1>
                        <p class="product-code" style="color:#333;margin:0.25rem 0 0.6rem 0;">Product Code: <strong id="product-code">TEMPLATE-ID</strong></p>
                        <p id="product-subtitle" style="color:#555;">Short tagline or subtitle</p>

                        <h3>Product Description</h3>
                        <div id="product-description-html">
                            <p>Replace this block with the product description.</p>
                        </div>

                        <h4>Key Features</h4>
                        <ul id="product-features">
                            <li>Feature 1</li>
                            <li>Feature 2</li>
                        </ul>

                        <h4>Technical Details</h4>
                        <ul id="product-specs">
                            <li><strong>Body Height:</strong> —</li>
                            <li><strong>Product Height:</strong> —</li>
                        </ul>

                        <h4>Care & Use</h4>
                        <p id="product-care">Care instructions here.</p>
                    </div>
                </div>

                <aside class="product-aside">
                    <div class="price-box" style="background:#f8f8f8;border-radius:8px;box-shadow:0 5px 15px rgba(0,0,0,0.05);text-align:left;">
                        <div style="padding:0.25rem 0 1rem 0;">
                            <p style="margin:0;color:#777;">MRP</p>
                            <p id="product-price" style="font-size:1.8rem;font-weight:bold;margin:0.5rem 0;">₹0</p>
                            <p style="color:#777;margin-bottom:1rem;">Inclusive of all taxes</p>
                        </div>

                        <div style="display:flex;gap:0.6rem;">
                            <button id="add-to-cart-btn" class="btn-secondary" style="flex:1;">Add to Cart</button>
                            <button id="buy-now-btn" class="btn-primary" style="flex:1;">Buy Now</button>
                        </div>

                        <div style="margin-top:1rem;font-size:0.95rem;color:#333;">
                            <p><strong>Delivery:</strong> <span id="product-delivery">3-6 business days</span></p>
                            <p><strong>Return:</strong> <span id="product-return">7 days (if unopened)</span></p>
                        </div>
                    </div>
                </aside>
            </div>
        </section>

        <section class="related-products" style="padding:2rem;">
            <h2 style="text-align:left;">Related Products</h2>
            <div class="product-grid" id="related-products-grid">
                <!-- related product cards (clone or render from data) -->
            </div>
        </section>
    </main>

    <footer>
        <script src="/components/js/footer.js"></script>
    </footer>

    <button id="scroll-to-top"><i class="fa-solid fa-arrow-up"></i></button>

    <script src="../main.js"></script>

    <!-- old embedded product JSON removed; now load products.json and render by ?id= -->
    <script>
    (function(){
      function qs(name){ const params = new URLSearchParams(location.search); return params.get(name); }

      const productId = qs('id');
      fetch('products.json')
        .then(r => r.json())
        .then(products => {
          if(!products || !products.length) return;
          const product = products.find(p => p.id === productId) || products[0];
          document.title = (product.title || 'Product') + ' — Product';
          document.getElementById('product-title').textContent = product.title || '';
          document.getElementById('product-subtitle').textContent = product.subtitle || '';
          document.getElementById('product-breadcrumb-title').textContent = product.title || '';
                    // show product code
                    const codeEl = document.getElementById('product-code');
                    if(codeEl) codeEl.textContent = product.id || '';
          document.getElementById('product-price').textContent = product.price ? '₹' + product.price : '₹0';
          document.getElementById('product-delivery').textContent = product.delivery || '';
          document.getElementById('product-return').textContent = product.return || '';

          // description
          const desc = document.getElementById('product-description-html');
          if(desc) desc.innerHTML = product.descriptionHtml || '';

          // features
          const featuresEl = document.getElementById('product-features');
          if(featuresEl){ featuresEl.innerHTML = ''; (product.features||[]).forEach(f => { const li = document.createElement('li'); li.textContent = f; featuresEl.appendChild(li); }); }

          // specs
          const specsEl = document.getElementById('product-specs');
          if(specsEl){ specsEl.innerHTML = ''; if(product.specs){ Object.keys(product.specs).forEach(k => { const li = document.createElement('li'); li.innerHTML = '<strong>' + k + ':</strong> ' + product.specs[k]; specsEl.appendChild(li); }); } }

          // Build slides for new carousel
          const carousel = document.getElementById('product-slider');
          const track = document.getElementById('carousel-track');
          const dotsContainer = document.getElementById('carousel-dots');
          track.innerHTML = '';
          dotsContainer.innerHTML = '';
          
          const allMedia = [];
          
          // Add images
          (product.images || []).forEach(src => {
              const imgSrc = (src && (src.startsWith('/') || src.startsWith('http'))) ? src : ('../' + src);
              allMedia.push({ type: 'image', src: imgSrc });
          });
          
          // Add video if exists
          if (product.video) {
              allMedia.push({ type: 'video', src: product.video });
          }
          
          // Create slides and dots
          allMedia.forEach((media, index) => {
              const slide = document.createElement('div');
              slide.className = 'product-carousel-slide' + (media.type === 'video' ? ' video-slide' : '');
              
              if (media.type === 'image') {
                  const img = document.createElement('img');
                  img.src = media.src;
                  img.alt = product.title || '';
                  img.draggable = false;
                  slide.appendChild(img);
              } else if (media.type === 'video') {
                  const iframe = document.createElement('iframe');
                  iframe.src = media.src;
                  iframe.allowFullscreen = true;
                  iframe.setAttribute('frameborder', '0');
                  slide.appendChild(iframe);
              }
              
              track.appendChild(slide);
              
              // Create dot
              const dot = document.createElement('button');
              dot.className = 'carousel-dot' + (index === 0 ? ' active' : '');
              dot.setAttribute('aria-label', 'Go to slide ' + (index + 1));
              dot.dataset.index = index;
              dotsContainer.appendChild(dot);
          });
          
          // Carousel drag functionality
          let isDragging = false;
          let startX = 0;
          let currentTranslate = 0;
          let prevTranslate = 0;
          let currentIndex = 0;
          const slideCount = allMedia.length;
          
          function getSlideWidth() {
              const slide = track.querySelector('.product-carousel-slide');
              if (!slide) return 395;
              return slide.offsetWidth + 15; // width + margin
          }
          
          function setPositionByIndex(animate = true) {
              if (!animate) {
                  track.style.transition = 'none';
              } else {
                  track.style.transition = 'transform 0.3s ease-out';
              }
              const slideWidth = getSlideWidth();
              const carouselWidth = carousel.offsetWidth;
              const centerOffset = (carouselWidth - slideWidth + 15) / 2;
              currentTranslate = centerOffset - (currentIndex * slideWidth);
              prevTranslate = currentTranslate;
              track.style.transform = 'translateX(' + currentTranslate + 'px)';
              
              // Update dots
              document.querySelectorAll('.carousel-dot').forEach((dot, i) => {
                  dot.classList.toggle('active', i === currentIndex);
              });
          }
          
          function touchStart(e) {
              isDragging = true;
              startX = getPositionX(e);
              carousel.classList.add('dragging', 'grabbing');
          }
          
          function touchMove(e) {
              if (!isDragging) return;
              const currentX = getPositionX(e);
              const diff = currentX - startX;
              currentTranslate = prevTranslate + diff;
              track.style.transform = 'translateX(' + currentTranslate + 'px)';
          }
          
          function touchEnd() {
              isDragging = false;
              carousel.classList.remove('dragging', 'grabbing');
              
              const movedBy = currentTranslate - prevTranslate;
              const slideWidth = getSlideWidth();
              
              // Determine direction and snap
              if (movedBy < -50 && currentIndex < slideCount - 1) {
                  currentIndex++;
              } else if (movedBy > 50 && currentIndex > 0) {
                  currentIndex--;
              }
              
              setPositionByIndex();
          }
          
          function getPositionX(e) {
              return e.type.includes('mouse') ? e.pageX : e.touches[0].clientX;
          }
          
          // Mouse events
          carousel.addEventListener('mousedown', touchStart);
          carousel.addEventListener('mousemove', touchMove);
          carousel.addEventListener('mouseup', touchEnd);
          carousel.addEventListener('mouseleave', () => {
              if (isDragging) touchEnd();
          });
          
          // Touch events
          carousel.addEventListener('touchstart', touchStart, { passive: true });
          carousel.addEventListener('touchmove', touchMove, { passive: true });
          carousel.addEventListener('touchend', touchEnd);
          
          // Prevent context menu on long press
          carousel.addEventListener('contextmenu', e => e.preventDefault());
          
          // Dot click navigation
          dotsContainer.addEventListener('click', (e) => {
              if (e.target.classList.contains('carousel-dot')) {
                  currentIndex = parseInt(e.target.dataset.index);
                  setPositionByIndex();
              }
          });
          
          // Initialize position
          if (slideCount > 0) {
              setTimeout(() => setPositionByIndex(false), 50);
          }
          
          // Handle resize
          window.addEventListener('resize', () => setPositionByIndex(false));

                    // related: `product.related` may be an array of ids (strings) or objects with an `id`.
                    const relatedGrid = document.getElementById('related-products-grid');
                    relatedGrid.innerHTML = '';
                    const relatedIds = product.related || [];
                    // If relatedIds contains strings (ids) or objects with id, look up the full product in `products`
                    relatedIds.forEach(rel => {
                        const relId = (typeof rel === 'string') ? rel : (rel && (rel.id || rel.productId || ''));
                        if(!relId) return;
                        const relProduct = products.find(p => p.id === relId);
                        if(!relProduct) return; // skip if not found

                        const card = document.createElement('div');
                        card.className = 'product-card';
                        card.dataset.id = relProduct.id || '';

                        // Normalize image path the same way as slider (keep root/absolute urls as-is, otherwise prefix ../)
                        const relImgRaw = (relProduct.images && relProduct.images[0]) ? relProduct.images[0] : '';
                        const relatedImg = (relImgRaw && (relImgRaw.startsWith('/') || relImgRaw.startsWith('http'))) ? relImgRaw : (relImgRaw ? ('../' + relImgRaw) : 'https://via.placeholder.com/400x300');

                        const productUrl = '../categories/product-template.html?id=' + encodeURIComponent(relProduct.id);
                        card.innerHTML = '<a href="'+productUrl+'"><img src="'+relatedImg+'" alt="'+(relProduct.title||'')+'"></a><h3>'+ (relProduct.title||'') +'</h3><p>₹'+(relProduct.price||'0')+'</p><button class="btn-secondary">Add to Cart</button>';
                        relatedGrid.appendChild(card);
                    });

          // cart actions reuse existing add to cart logic
                const productDataForCart = { id: product.id, name: product.title, price: product.price, image: (product.images && product.images[0]) ? ((product.images[0].startsWith('/') || product.images[0].startsWith('http')) ? product.images[0] : ('../' + product.images[0])) : '' };

          function addToCartLocal(product){
            let cart = JSON.parse(localStorage.getItem('cart')) || [];
            const existing = cart.find(i => i.id === product.id);
            if(existing) existing.quantity++;
            else cart.push({...product, quantity: 1});
            localStorage.setItem('cart', JSON.stringify(cart));
            const cartCount = document.querySelector('.cart-count');
            if(cartCount) cartCount.textContent = cart.reduce((acc, i) => acc + i.quantity, 0);
          }
                    // delegate clicks on related product 'Add to Cart' buttons to open product page first
                    document.addEventListener('click', function(e){
                        if(e.target.classList && e.target.classList.contains('btn-secondary')){
                            const card = e.target.closest('.product-card');
                            if(card && card.dataset && card.dataset.id){
                                // navigate to that product page (open product page first)
                                window.location.href = '/categories/product-template.html?id=' + encodeURIComponent(card.dataset.id);
                            }
                        }
                    });

          const addBtn = document.getElementById('add-to-cart-btn');
          const buyBtn = document.getElementById('buy-now-btn');
                    // show toast helper
                    function showToast(message){
                        let t = document.createElement('div');
                        t.className = 'site-toast';
                        t.textContent = message;
                        document.body.appendChild(t);
                        // force reflow
                        void t.offsetWidth;
                        t.classList.add('show');
                        setTimeout(()=>{ t.classList.remove('show'); setTimeout(()=> t.remove(),300); }, 2200);
                    }

                    if(addBtn) addBtn.addEventListener('click', ()=>{ addToCartLocal(productDataForCart); showToast('Item added to cart'); });
                    if(buyBtn) buyBtn.addEventListener('click', ()=>{ addToCartLocal(productDataForCart); showToast('Item added to cart'); window.location.href = '../cart.html'; });

        })
        .catch(err => { console.error('Failed to load products.json', err); });
    })();
    </script>
    <nav class="mobile-bottom-nav" aria-label="Mobile navigation">
        <div class="nav-row">
            <a href="#" class="mobile-menu"><i class="fa-solid fa-bars"></i><span>Menu</span></a>
            <a href="../cart.html" class="mobile-cart"><i class="fa-solid fa-cart-shopping"></i><span>Cart</span></a>
            <a href="../index.html" class="mobile-home"><i class="fa-solid fa-home"></i><span>Home</span></a>
            <a href="#" class="mobile-login"><i class="fa-solid fa-user"></i><span>Profile</span></a>
        </div>
    </nav>
</body>
</html>